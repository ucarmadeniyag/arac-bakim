<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Araç Bakım Takip</title>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, select, button { margin: 5px 0; padding: 8px; font-size: 14px; }
    label { font-weight: bold; }
    #qrcodeContainer, #qrcodeContainer2 { margin-top: 15px; }
    .form-section { margin-bottom: 25px; border: 1px solid #ccc; padding: 15px; border-radius: 8px; max-width: 400px; }
  </style>
</head>
<body>
  <h1>Araç Bakım Takip</h1>

  <label for="plakaInput">Plaka:</label>
  <input id="plakaInput" type="text" placeholder="Plaka girin" />

  <button id="silButon" style="display:none;">Bakım Kayıtlarını Sil</button>

  <div id="bakimListesi"></div>

  <div class="form-section">
    <h3>Bakım Ekle (Otomatik Tarih)</h3>
    <form id="bakimEkleForm">
      <label>İşlem Türü:</label><br />
      <input type="checkbox" id="yagDegisimi" name="islem" value="Yağ Değişimi" /> Yağ Değişimi<br />
      <input type="checkbox" id="frenBakimi" name="islem" value="Fren Bakımı" /> Fren Bakımı<br />
      <input type="checkbox" id="lastikKontrol" name="islem" value="Lastik Kontrol" /> Lastik Kontrol<br />
      <button type="submit">Bakım Ekle</button>
    </form>
    <div id="qrcodeContainer"></div>
  </div>

  <div class="form-section">
    <h3>Bakım Ekle (Manuel Tarih)</h3>
    <form id="bakimEkleForm2">
      <label for="tarihInput2">Tarih:</label><br />
      <input type="date" id="tarihInput2" required /><br />
      <label>İşlem Türü:</label><br />
      <input type="checkbox" id="yagDegisimi2" name="islem2" value="Yağ Değişimi" /> Yağ Değişimi<br />
      <input type="checkbox" id="frenBakimi2" name="islem2" value="Fren Bakımı" /> Fren Bakımı<br />
      <input type="checkbox" id="lastikKontrol2" name="islem2" value="Lastik Kontrol" /> Lastik Kontrol<br />
      <button type="submit">Bakım Ekle</button>
    </form>
    <div id="qrcodeContainer2"></div>
  </div>

  <script>
    const plakaInput = document.getElementById('plakaInput');
    const silButon = document.getElementById('silButon');
    const bakimListesi = document.getElementById('bakimListesi');

    const bakimEkleForm = document.getElementById('bakimEkleForm');
    const bakimEkleForm2 = document.getElementById('bakimEkleForm2');
    const tarihInput2 = document.getElementById('tarihInput2');

    const qrcodeContainer = document.getElementById('qrcodeContainer');
    const qrcodeContainer2 = document.getElementById('qrcodeContainer2');

    let seciliPlaka = '';

    // QR kodu sadece plakaya bağlı olarak oluştur
    function generateQrCode(plaka) {
      if (!plaka) return;
      const qrMetin = `ARAÇ PLAKASI: ${plaka}`;
      qrcodeContainer.innerHTML = '';
      qrcodeContainer2.innerHTML = '';

      const canvas = document.createElement('canvas');
      qrcodeContainer.appendChild(canvas);
      QRCode.toCanvas(canvas, qrMetin, { width: 150 }, (error) => {
        if (error) console.error(error);
      });

      const canvas2 = document.createElement('canvas');
      qrcodeContainer2.appendChild(canvas2);
      QRCode.toCanvas(canvas2, qrMetin, { width: 150 }, (error) => {
        if (error) console.error(error);
      });
    }

    // Bakımları sunucudan çek (örnek, fetch ile api isteği yapılacak)
    function fetchBakimlar(plaka) {
      // Örnek dummy veri
      // Gerçek uygulamada fetch ile backend'den al
      const dummyBakimlar = [
        { tarih: '2025-05-01', islemler: ['Yağ Değişimi', 'Fren Bakımı'] },
        { tarih: '2025-04-15', islemler: ['Lastik Kontrol'] },
      ];

      let html = `<h3>${plaka} - Bakım Kayıtları</h3>`;
      html += '<ul>';
      dummyBakimlar.forEach((bakim) => {
        html += `<li>${bakim.tarih}: ${bakim.islemler.join(', ')}</li>`;
      });
      html += '</ul>';
      bakimListesi.innerHTML = html;
    }

    // Plaka input değiştiğinde bakım getir ve QR kodu oluştur
    plakaInput.addEventListener('change', () => {
      const plaka = plakaInput.value.trim().toUpperCase();
      if (!plaka) return;
      seciliPlaka = plaka;
      fetchBakimlar(plaka);
      silButon.style.display = 'inline-block';
      generateQrCode(plaka);
    });

    // Otomatik tarihli bakım ekleme formu
    bakimEkleForm.addEventListener('submit', (e) => {
      e.preventDefault();
      if (!seciliPlaka) {
        alert('Lütfen önce plaka girin.');
        return;
      }
      const islemEtiketleri = [];
      ['yagDegisimi', 'frenBakimi', 'lastikKontrol'].forEach((id) => {
        if (document.getElementById(id).checked) {
          islemEtiketleri.push(document.getElementById(id).value);
        }
      });
      if (islemEtiketleri.length === 0) {
        alert('Lütfen en az bir işlem seçin.');
        return;
      }
      const tarih = new Date().toISOString().slice(0, 10);
      // Burada API'ye POST isteği gönderilebilir
      alert(`${seciliPlaka} için ${tarih} tarihli bakım eklendi: ${islemEtiketleri.join(', ')}`);

      // Bakım listesi güncellenir (örnek)
      fetchBakimlar(seciliPlaka);

      // QR kod oluşturma burada kaldırıldı, sabit plakaya göre kalacak
      // generateQrCode(seciliPlaka);

      // Form temizle
      bakimEkleForm.reset();
    });

    // Manuel tarihli bakım ekleme formu
    bakimEkleForm2.addEventListener('submit', (e) => {
      e.preventDefault();
      if (!seciliPlaka) {
        alert('Lütfen önce plaka girin.');
        return;
      }
      const islemEtiketleri = [];
      ['yagDegisimi2', 'frenBakimi2', 'lastikKontrol2'].forEach((id) => {
        if (document.getElementById(id).checked) {
          islemEtiketleri.push(document.getElementById(id).value);
        }
      });
      if (islemEtiketleri.length === 0) {
        alert('Lütfen en az bir işlem seçin.');
        return;
      }
      const tarih = tarihInput2.value;
      if (!tarih) {
        alert('Lütfen tarih seçin.');
        return;
      }
      // Burada API'ye POST isteği gönderilebilir
      alert(`${seciliPlaka} için ${tarih} tarihli bakım eklendi: ${islemEtiketleri.join(', ')}`);

      // Bakım listesi güncellenir (örnek)
      fetchBakimlar(seciliPlaka);

      // QR kod oluşturma burada kaldırıldı, sabit plakaya göre kalacak
      // generateQrCode(seciliPlaka);

      // Form temizle
      bakimEkleForm2.reset();
    });

    // Sil butonuna tıklanınca bakım kayıtlarını sil (örnek)
    silButon.addEventListener('click', () => {
      if (!seciliPlaka) return;
      if (!confirm(`${seciliPlaka} plakalı aracın tüm bakım kayıtları silinecek, emin misiniz?`)) return;

      // API'ye DELETE isteği gönderilecek burada (örnek)
      alert(`${seciliPlaka} plakalı aracın bakım kayıtları silindi.`);

      // Listeyi temizle
      bakimListesi.innerHTML = '';

      // QR kodu kalabilir, çünkü QR kod sadece plakaya bağlı
    });
  </script>
</body>
</html>
