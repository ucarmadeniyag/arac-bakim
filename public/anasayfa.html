<body>
  <h1>Servis Formu</h1>

  <h2>Plakalar</h2>
  <ul id="plakalar"></ul>

  <!-- BURAYA EKLE -->
  <h2>Bakım Ekle</h2>
  <form id="bakimEkleForm">
    <label for="plakaInput">Araç Plakası:</label><br/>
    <input type="text" id="plakaInput" name="plaka" required /><br/>

    <label for="islemSelect">İşlem:</label><br/>
    <select id="islemSelect" name="islem" required>
      <option value="">Seçiniz</option>
      <option value="Yağ Değişimi">Yağ Değişimi</option>
      <option value="Filtre Değişimi">Lastik Değişimi</option>
      <option value="Not">Fren Kontrolü</option>
    </select><br/><br/>

    <button type="submit">Bakım Ekle</button>
  </form>

  <p id="eklemeMesaji" style="color: green; display:none;"></p>
  <!-- EKLEME SONU -->

  <div id="bakimDetay">
    <h2>Bakım Detayları</h2>
    <table id="bakimTable" style="display:none;">
      <thead>
        <tr>
          <th>Tarih</th>
          <th>Servis</th>
          <th>Detay</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <p id="noData" style="display:none;">Seçilen plaka için bakım kaydı bulunamadı.</p>
  </div>

  <div id="tumQrKodlari">
    <h2>Geçmiş Plakaların QR Kodları</h2>
    <div id="qrListe" class="qr-container"></div>
  </div>

  <script>
    // ... Mevcut script burada ...

    // Buraya form gönderim kodunu da ekle:
    const bakimEkleForm = document.getElementById('bakimEkleForm');
    const eklemeMesaji = document.getElementById('eklemeMesaji');

    bakimEkleForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      let plaka = document.getElementById('plakaInput').value.trim().toUpperCase();
      let islem = document.getElementById('islemSelect').value;

      if (!plaka || !islem) {
        alert('Lütfen tüm alanları doldurun.');
        return;
      }

      const tarih = new Date().toISOString().split('T')[0];

      try {
        const res = await fetch(`/api/bakimlar/${plaka}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ tarih, islem })
        });

        const data = await res.json();

        if (res.ok) {
          eklemeMesaji.textContent = 'Bakım kaydı başarıyla eklendi!';
          eklemeMesaji.style.color = 'green';
          eklemeMesaji.style.display = 'block';

          bakimEkleForm.reset();

          // Eğer plakalar listesinde yoksa ekle
          if (![...plakalarUl.children].some(li => li.textContent === plaka)) {
            const li = document.createElement('li');
            li.textContent = plaka;
            li.addEventListener('click', () => fetchBakimlar(plaka));
            plakalarUl.appendChild(li);
          }

          fetchBakimlar(plaka);
          tumQRListele();

        } else {
          eklemeMesaji.textContent = data.message || 'Bir hata oluştu!';
          eklemeMesaji.style.color = 'red';
          eklemeMesaji.style.display = 'block';
        }
      } catch (err) {
        eklemeMesaji.textContent = 'Sunucuya bağlanırken hata oluştu.';
        eklemeMesaji.style.color = 'red';
        eklemeMesaji.style.display = 'block';
      }
    });
  </script>
</body>
